<!doctype html>
<html>
    <head>
        <title>Voice to Text</title>
    </head>
    <body>
        <button id="toggleButton">Start Voice Input</button>
        <select id="languageSelect">
            <option value="id-ID">Indonesian</option>
            <option value="en-US">English</option>
            <option value="zh-CN">Chinese</option>
        </select>
        <div id="output"></div>

        <script>
            const toggleButton = document.getElementById("toggleButton");
            const outputDiv = document.getElementById("output");
            const languageSelect = document.getElementById("languageSelect");

            const recognition = new (window.SpeechRecognition ||
                window.webkitSpeechRecognition ||
                window.mozSpeechRecognition ||
                window.msSpeechRecognition)();
            recognition.continuous = true; // Allows continuous listening

            let isListening = false;

            // Function to update the recognition language
            function updateLanguage() {
                recognition.lang = languageSelect.value;
            }

            recognition.onstart = () => {
                isListening = true;
                toggleButton.textContent = "Stop Voice Input";
            };

            recognition.onresult = (event) => {
                let transcript = "";
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                outputDiv.textContent = transcript;
            };

            recognition.onend = () => {
                isListening = false;
                toggleButton.textContent = "Start Voice Input";
            };

            recognition.onerror = (event) => {
                console.error("Speech recognition error:", event.error);
                isListening = false;
                toggleButton.textContent = "Start Voice Input";
            };

            toggleButton.addEventListener("click", () => {
                if (isListening) {
                    recognition.stop();
                } else {
                    updateLanguage(); // Update language before starting
                    recognition.start();
                }
            });
        </script>
    </body>
</html>
